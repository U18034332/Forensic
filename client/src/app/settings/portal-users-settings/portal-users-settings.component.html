<div class="settings-portal-users-view">
    <div class="settings-portal-users-title">Portal Users</div>
  
    <div class="portal-users-settings-boxstyling">
      <div class="user-list" id="user-list">
        <table mat-table [dataSource]="users" class="UserNumer1Table">
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let user">
              <button mat-icon-button (click)="navigateToUser(user.userId)" title="View cases for {{user.username}}">
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </td>
          </ng-container>
  
          <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef>Username</th>
            <td mat-cell *matCellDef="let user">{{user.username}}</td>
          </ng-container>
  
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let user">{{user.email}}</td>
          </ng-container>
  
          <ng-container matColumnDef="telephone">
            <th mat-header-cell *matHeaderCellDef>Telephone</th>
            <td mat-cell *matCellDef="let user">{{user.telephone}}</td>
          </ng-container>
  
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Role</th>
            <td mat-cell *matCellDef="let user">{{user.role}}</td>
          </ng-container>
  
          <ng-container matColumnDef="userId">
            <th mat-header-cell *matHeaderCellDef>User ID</th>
            <td mat-cell *matCellDef="let user">{{user.userId}}</td>
          </ng-container>
  
          <ng-container matColumnDef="invitationStatus">
            <th mat-header-cell *matHeaderCellDef>Invitation Status</th>
            <td mat-cell *matCellDef="let user">{{user.invitationStatus}}</td>
          </ng-container>
  
          <ng-container matColumnDef="workload">
            <th mat-header-cell *matHeaderCellDef>Workload</th>
            <td mat-cell *matCellDef="let user">
              <span [ngClass]="getWorkloadClass(user.workload)">{{user.workload}}</span>
            </td>
          </ng-container>
  
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>
  
    <!-- Detailed User Cases View -->
    <div class="popover" *ngFor="let user of users" id="user-{{user.userId}}">
      <div class="content">
        <!-- Close button -->
        <a href="#user-list" class="close" title="Back to user list" (click)="closePopover($event)">Ã—</a>
  
        <h2>User: {{user.username}}</h2>
        <div class="workload-info">Workload: {{user.workload}}</div>
  
        <!-- Case table -->
        <table mat-table [dataSource]="user.cases" class="mat-elevation-z2 case-table">
          <ng-container matColumnDef="caseId">
            <th mat-header-cell *matHeaderCellDef>Case ID</th>
            <td mat-cell *matCellDef="let case">{{case.caseId}}</td>
          </ng-container>
  
          <ng-container matColumnDef="severity">
            <th mat-header-cell *matHeaderCellDef>Severity</th>
            <td mat-cell *matCellDef="let case" [ngClass]="getSeverityClass(case.severity)">{{case.severity}}</td>
          </ng-container>
  
          <ng-container matColumnDef="startDate">
            <th mat-header-cell *matHeaderCellDef>Start Date</th>
            <td mat-cell *matCellDef="let case">{{case.startDate}}</td>
          </ng-container>
  
          <ng-container matColumnDef="projectNumber">
            <th mat-header-cell *matHeaderCellDef>Project Num.</th>
            <td mat-cell *matCellDef="let case">{{case.projectNumber}}</td>
          </ng-container>
  
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let case">{{case.status}}</td>
          </ng-container>
  
          <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef>Priority</th>
            <td mat-cell *matCellDef="let case">{{case.priority}}</td>
          </ng-container>
  
          <tr mat-header-row *matHeaderRowDef="['caseId', 'severity', 'startDate', 'projectNumber', 'status', 'priority']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['caseId', 'severity', 'startDate', 'projectNumber', 'status', 'priority'];"></tr>
        </table>
      </div>
    </div>
  </div>
  